{% load static i18n %}
{% get_current_language as CURRENT_LANGUAGE %}
<!DOCTYPE html>
<html lang="{{ CURRENT_LANGUAGE|default:'fr' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Rejoignez dès maintenant votre tchat gratuit sans inscription et discuter avec des milliers d'utilisateurs sur le tchatche. Rencontre amicale gratuit sans inscription chez tchatzone!">
    <meta name="classification" content="Internet, Chat, Communaute, Portail, Services, Chat, Rencontres">
    <meta name="type" content="chat">
    <meta name="robots" content="index, follow">
    <meta name="distribution" content="global">
    <meta name="identifier-url" content="{{ site_brand.base_url }}/">
    <meta name="rating" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="chat en ligne, discussion instantanée, tchat gratuit, rencontres, chat sans inscription">
    <meta name="author" content="{{ site_brand.meta_author }}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'images/apple-touch-icon-120x120-precomposed.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'images/apple-touch-icon-152x152-precomposed.png' %}">
    <meta property="og:title" content="Rejoignez dès maintenant votre tchat gratuit sans inscription et discuter avec des milliers d'utilisateurs du monde entier. bon tchatche sur votre site de discussion !">
    <meta property="og:description" content="Rejoignez notre chat gratuit pour discuter en direct avec de nouvelles personnes. Aucune inscription requise !">
    <meta property="og:image" content="{% static 'images/banner/shape/home3/01.png' %}">
    <meta property="og:url" content="{{ canonical_url }}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="{{ site_brand.site_name }}">
    <meta property="og:locale" content="fr_FR">
    <link rel="canonical" href="{{ canonical_url }}">


    <title>{% block title %}{{ site_brand.default_title }}{% endblock %}</title>
    
    <!-- Stylesheets: load non-blocking to improve mobile LCP -->
    <style>
        /* Minimal critical paint (avoid stark FOUC while main CSS loads) */
        html, body { margin: 0; padding: 0; }
        body { font-family: "Public Sans", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
    </style>

    <style>
        /* Ensure icon text remains visible while fonts load (Lighthouse: font-display). */
        @font-face {
            font-family: bootstrap-icons;
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src:
                url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/fonts/bootstrap-icons.woff2?dd67030699838ea613ee6dbda90effa6") format("woff2"),
                url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/fonts/bootstrap-icons.woff?dd67030699838ea613ee6dbda90effa6") format("woff");
        }
    </style>

    <link rel="preload" as="style" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">

    <link rel="preload" as="style" href="{% static 'css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">

    <!-- Non-critical CSS (already deferred) -->
    <link rel="preload" as="style" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">

    <link rel="preload" as="style" href="{% static 'css/style.css' %}?v={{ static_version }}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v={{ static_version }}">

    <link rel="preload" as="style" href="{% static 'css/header-modern.css' %}?v={{ static_version }}">
    <link rel="stylesheet" href="{% static 'css/header-modern.css' %}?v={{ static_version }}">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="preload" as="style" href="{% static 'css/font-display-overrides.css' %}?v={{ static_version }}">
    <link rel="stylesheet" href="{% static 'css/font-display-overrides.css' %}?v={{ static_version }}">
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">

    <!-- Cookie consent UI styles (professional, informative, accessible) -->
    <link rel="preload" as="style" href="{% static 'css/cookie-consent.css' %}?v={{ static_version }}">
    <link rel="stylesheet" href="{% static 'css/cookie-consent.css' %}?v={{ static_version }}">

    <!-- Trusted Types (CSP3): define a default policy for legacy/third-party scripts -->
    <script nonce="{{ request.csp_nonce }}">
        (function () {
            if (!window.trustedTypes || !window.trustedTypes.createPolicy) return;
            try {
                window.trustedTypes.createPolicy('default', {
                    createHTML: function (s) { return String(s); },
                    createScriptURL: function (s) { return String(s); },
                    createScript: function (s) { return String(s); },
                });
            } catch (e) {
                // Ignore if policy already exists.
            }
        })();
    </script>

    <!-- Google Consent Mode v2 (for GTM) -->
    <script nonce="{{ request.csp_nonce }}" data-cookieconsent="ignore">
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }

        // Default to DENIED until the user makes an explicit choice.
        // The cookie-consent UI will call gtag('consent','update', ...) after selection.
        gtag('consent', 'default', {
            'ad_personalization': 'denied',
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'analytics_storage': 'denied',
            'functionality_storage': 'denied',
            'personalization_storage': 'denied',
            'security_storage': 'granted',
            'wait_for_update': 500,
        });

        gtag('set', 'ads_data_redaction', true);
        gtag('set', 'url_passthrough', false);

        // Load GTM only if the user consented (prevents console/network errors when denied).
        (function () {
            var loaded = false;

            function getCookie(name) {
                var match = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([.$?*|{}()\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)'));
                return match ? decodeURIComponent(match[1]) : '';
            }

            window.__loadGTMIfConsented = function () {
                if (loaded) return;
                // Require explicit consent on at least one tracking category.
                var analytics = getCookie('cookie_analytics') === 'yes';
                var advertising = getCookie('cookie_advertising') === 'yes';
                if (!analytics && !advertising) return;

                loaded = true;
                window.dataLayer = window.dataLayer || [];
                window.dataLayer.push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });

                var script = document.createElement('script');
                script.async = true;
                script.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-5J4F54MR';
                script.nonce = "{{ request.csp_nonce }}";
                var first = document.getElementsByTagName('script')[0];
                first.parentNode.insertBefore(script, first);
            };

            // Attempt immediately for returning users (cookie already set).
            window.__loadGTMIfConsented();
        })();
    </script>

    <!-- Google Fonts (defer CSS to reduce render blocking) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
    {% block head %}{% endblock %}
</head>
<body>   

    <div style="display:none">{% csrf_token %}</div>

    <!-- Google Tag Manager (noscript) -->

    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5J4F54MR"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    {% include 'main/header.html' %}

    
        {% block content %}
        
        
        {% endblock %}
   

    {% include 'main/footer.html' %}

    <!-- Cookie Banner -->
    <div id="cookie-banner" role="dialog" aria-modal="true" aria-label="Consentement cookies">
        <div class="cookie-header-row">
            <div class="cookie-title" aria-hidden="true">
                <svg class="cookie-icon" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
                    <defs>
                        <linearGradient id="cookieGrad" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0" stop-color="#ffcc80" />
                            <stop offset="1" stop-color="#ffb74d" />
                        </linearGradient>
                    </defs>
                    <path d="M32 6c9 0 17 4 22 10-5 4-11 6-17 6-6 0-11-2-15-6C19 10 25 6 32 6Z" fill="rgba(0,0,0,0.12)"/>
                    <path d="M32 10c12.2 0 22 9.8 22 22S44.2 54 32 54 10 44.2 10 32c0-1.6.2-3.2.5-4.7C18 30 26 26 30 18c6 6 16 6 22 0 1.3 2.1 2 4.6 2 7.3 0 7.7-6.3 14-14 14-6.9 0-12.7-5-13.8-11.6-4.2 6.2-11.6 9.2-18.9 8.4C8.4 45.1 18.9 54 32 54Z" fill="rgba(0,0,0,0.08)"/>
                    <circle cx="32" cy="32" r="22" fill="url(#cookieGrad)"/>
                    <circle cx="22" cy="26" r="3.2" fill="#6d4c41" opacity="0.9"/>
                    <circle cx="38" cy="24" r="2.8" fill="#6d4c41" opacity="0.9"/>
                    <circle cx="42" cy="36" r="3.4" fill="#6d4c41" opacity="0.9"/>
                    <circle cx="26" cy="40" r="2.6" fill="#6d4c41" opacity="0.9"/>
                    <circle cx="32" cy="44" r="2.2" fill="#6d4c41" opacity="0.9"/>
                </svg>
                <span class="cookie-title-site">{{ site_brand.site_name }} demande votre consentement</span>
                <span class="cookie-title-generic">Cookies</span>
            </div>
            <div class="cookie-mini-actions" aria-hidden="true">
                <div id="cookie-status" class="cookie-status" aria-live="polite"></div>
                <button id="cookie-mini-settings" class="cookie-mini-settings" type="button" aria-label="Ouvrir les préférences cookies">
                    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M12 2a10 10 0 1 0 10 10c0-.4 0-.8-.1-1.2-2.8.2-5.4-.8-7.2-2.6C12.9 6.4 12 4.2 12 2Zm0 4.2c.3 1.4 1 2.7 2.1 3.8 2 2 4.9 2.9 7.7 2.3A8 8 0 1 1 12 6.2Zm-3.2 6.5a1.2 1.2 0 1 1 0-2.4 1.2 1.2 0 0 1 0 2.4Zm3.7-2.9a1.1 1.1 0 1 1 0-2.2 1.1 1.1 0 0 1 0 2.2Zm2.8 5.5a1.3 1.3 0 1 1 0-2.6 1.3 1.3 0 0 1 0 2.6Z"/>
                    </svg>
                </button>
            </div>
        </div>
        <p class="cookie-description">
            Nous utilisons des cookies pour faire fonctionner le site, mesurer l’audience et (si vous l’autorisez) proposer des contenus/publicités plus pertinents.
            Vous pouvez modifier vos préférences à tout moment.
        </p>
        <div class="cookie-buttons">
            <button id="cookie-accept" class="cookie-button cookie-accept" type="button">Accepter</button>
            <button id="cookie-settings" class="cookie-button cookie-settings" type="button">Personnaliser</button>
            <button id="cookie-decline" class="cookie-button cookie-decline" type="button">Refuser</button>
        </div>
        <div class="cookie-links">
            <a class="cookie-privacy" href="/privacy/" rel="nofollow">Politique de confidentialité</a>
        </div>
    </div>

    <div id="cookie-backdrop" aria-hidden="true"></div>

    <!-- Cookie Settings Modal -->
    <div id="cookie-modal" role="dialog" aria-modal="true" aria-label="Préférences des cookies">
        <div class="cookie-modal-header">
            <div>
                <h3 class="cookie-modal-title">Préférences des cookies</h3>
                <p class="cookie-modal-subtitle">
                    Choisissez ce que vous autorisez. Les cookies strictement nécessaires au fonctionnement du site peuvent être utilisés même en cas de refus.
                    Les chiffres ci-dessous reflètent uniquement les cookies 1ère partie détectés dans votre navigateur.
                </p>
            </div>
            <button id="close-cookie-settings" class="cookie-modal-close" type="button" aria-label="Fermer">
                ✕
            </button>
        </div>

        <div class="cookie-summary" aria-live="polite">
            <div class="cookie-summary-row">
                <span>État actuel</span>
                <span class="cookie-pill" id="cookie-choice-pill">—</span>
            </div>
            <div class="cookie-summary-row">
                <span>Cookies détectés (1ère partie)</span>
                <strong><span id="cookie-count-total">0</span></strong>
            </div>
            <div class="cookie-summary-note">
                Le compteur liste uniquement les cookies <strong>1ère partie</strong> visibles via <code>document.cookie</code>. Selon votre navigateur/adblock, il peut rester à 0 tant qu’aucun cookie n’a été posé (souvent après consentement + rechargement). Les cookies <strong>tiers</strong> ne sont pas détectables ici.
            </div>
            <div class="cookie-summary-row">
                <span>Dernière mise à jour</span>
                <strong><span id="cookie-last-updated">—</span></strong>
            </div>
        </div>

        <div class="cookie-grid">
            <div class="cookie-card">
                <div class="cookie-card-head">
                    <div>
                        <p class="cookie-card-title">Mesure d’audience</p>
                        <div class="cookie-card-meta"><span id="cookie-count-analytics">0</span> détecté(s) • <span id="cookie-known-analytics">0</span> connu(s)</div>
                    </div>
                    <label class="cookie-switch" for="cookie-analytics">
                        <input type="checkbox" id="cookie-analytics" aria-label="Mesure d’audience">
                    </label>
                </div>
                <p class="cookie-card-desc">
                    Permet de mesurer la fréquentation (pages vues, temps de visite, erreurs) afin d’améliorer le site. Exemple : Google Analytics / tags équivalents.
                </p>
                <details class="cookie-details">
                    <summary>Voir les cookies détectés</summary>
                    <ul class="cookie-cookie-list" id="cookie-list-analytics"></ul>
                </details>
            </div>

            <div class="cookie-card">
                <div class="cookie-card-head">
                    <div>
                        <p class="cookie-card-title">Fonctionnels</p>
                        <div class="cookie-card-meta"><span id="cookie-count-functional">0</span> détecté(s) • <span id="cookie-known-functional">0</span> connu(s)</div>
                    </div>
                    <label class="cookie-switch" for="cookie-functional">
                        <input type="checkbox" id="cookie-functional" aria-label="Fonctionnels">
                    </label>
                </div>
                <p class="cookie-card-desc">
                    Mémorise vos choix et améliore l’expérience (préférences, sécurité, sessions). La désactivation peut dégrader certaines fonctionnalités.
                </p>
                <details class="cookie-details">
                    <summary>Voir les cookies détectés</summary>
                    <ul class="cookie-cookie-list" id="cookie-list-functional"></ul>
                </details>
            </div>

            <div class="cookie-card">
                <div class="cookie-card-head">
                    <div>
                        <p class="cookie-card-title">Publicitaires</p>
                        <div class="cookie-card-meta"><span id="cookie-count-advertising">0</span> détecté(s) • <span id="cookie-known-advertising">0</span> connu(s)</div>
                    </div>
                    <label class="cookie-switch" for="cookie-advertising">
                        <input type="checkbox" id="cookie-advertising" aria-label="Publicitaires">
                    </label>
                </div>
                <p class="cookie-card-desc">
                    Utilisés pour mesurer des campagnes, limiter la répétition, et proposer des publicités plus pertinentes (selon votre consentement).
                </p>
                <details class="cookie-details">
                    <summary>Voir les cookies détectés</summary>
                    <ul class="cookie-cookie-list" id="cookie-list-advertising"></ul>
                </details>
            </div>

            <div class="cookie-card">
                <div class="cookie-card-head">
                    <div>
                        <p class="cookie-card-title">Sécurité (toujours actif)</p>
                        <div class="cookie-card-meta">Protection anti-abus, sécurité du site</div>
                    </div>
                    <span class="cookie-pill">Activé</span>
                </div>
                <p class="cookie-card-desc">
                    Certains stockages strictement nécessaires peuvent être utilisés pour protéger le site (ex. prévention des fraudes / sécurité).
                </p>
            </div>
        </div>

        <div class="cookie-modal-actions">
            <button id="cookie-modal-accept-all" class="cookie-button cookie-accept" type="button">Tout accepter</button>
            <button id="cookie-modal-decline-all" class="cookie-button cookie-decline" type="button">Tout refuser</button>
            <button id="save-cookie-settings" class="cookie-button cookie-settings" type="button">Sauvegarder</button>
        </div>

        <div class="cookie-links" style="margin-top: 12px;">
            <a href="/privacy/" rel="nofollow">Politique de confidentialité</a>
            <span class="cookie-sep">&nbsp;•&nbsp;</span>
            <a href="#" id="cookie-manage-modal" rel="nofollow">Modifier plus tard</a>
        </div>
    </div>

    {% block scripts %}
    
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/vendor/jquery-3.6.0.min.js' %}"></script>
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/vendor/modernizr-3.11.2.min.js' %}"></script>

    {# Page-specific vendor libs that must load AFTER jQuery and BEFORE main.js #}
    {% block page_vendor_scripts %}{% endblock %}

    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/vendor/bootstrap.bundle.min.js' %}"></script>
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/plugins.js' %}"></script>
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/img-fallback.js' %}?v={{ static_version }}"></script>
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/confirm.js' %}?v={{ static_version }}"></script>
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/main.js' %}?v={{ static_version }}"></script>

    {# Page-specific scripts that can load after main.js #}
    {% block page_scripts %}{% endblock %}

    <!-- Cookie consent logic -->
    <script nonce="{{ request.csp_nonce }}" defer src="https://cdn.jsdelivr.net/npm/js-cookie@3/dist/js.cookie.min.js"></script>
    <script nonce="{{ request.csp_nonce }}" defer src="{% static 'js/cookie-consent.js' %}?v={{ static_version }}&cb=20260116"></script>
    
    <script nonce="{{ request.csp_nonce }}">
        (function() {
            function fetchUserCount() {
                var currentEl = document.querySelector(".counter");
                if (!currentEl) return;

                fetch(window.location.href, { headers: { "X-Requested-With": "XMLHttpRequest" } })
                    .then(function(response) { return response.text(); })
                    .then(function(html) {
                        var parser = new DOMParser();
                        var doc = parser.parseFromString(html, "text/html");
                        var newEl = doc.querySelector(".counter");
                        if (!newEl) return;
                        currentEl.innerText = newEl.innerText;
                    })
                    .catch(function() {
                        // Ignore (page might block XHR, offline, or no counter on response)
                    });
            }

            // ✅ Only run on pages that have the counter
            if (document.querySelector(".counter")) {
                setInterval(fetchUserCount, 5000);
            }
        })();
    </script>
                  
    {% endblock %}
</body>
</html>